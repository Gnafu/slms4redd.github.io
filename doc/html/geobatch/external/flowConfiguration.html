<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Flow configuration &mdash; UNREDD NFMS 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/redd.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="UNREDD NFMS 1.0 documentation" href="../../index.html" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body role="document">
<div class="header">
  <div class="logo">
    <a href="../../index.html">
      <img class="logo" src="../../_static/un-redd.gif" alt="Logo"/>
    </a>
  </div>
  <div class="faologo">
  <table><tr><td>
    <a href="http://www.fao.org/">
      <img class="logo" src="../../_static/fao_logo.gif" alt="FAO"/>
    </a>
	</td><td>

      <img class="logo" src="../../_static/undp_logo.gif" alt="undp"/>
    </td><td>
      <img class="logo" src="../../_static/unep.gif" alt="unep"/>

	</td>
	</td></tr></table>
  </div>

</div>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">UNREDD NFMS 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="flow-configuration">
<h1>Flow configuration<a class="headerlink" href="#flow-configuration" title="Permalink to this headline">¶</a></h1>
<p>GeoBatch is based on flows, where specific <em>events</em> trigger a sequence of associated <em>actions</em>.</p>
<p>Events are generated by an <em>Event Generator</em>, which builds a queue of events controlled by the <em>Event Dispatcher</em> (producer-consumer). The Event Dispatcher starts an <em>Event Consumer</em> thread which effectively runs <em>actions</em> sequentially, as specified in the <em>flow</em> file.</p>
<p>Actually GeoBatch is using Xstream so flows are defined as XML files stored into <code class="docutils literal"><span class="pre">GEOBATCH_CONFIG_DIR</span></code>. Here is an example of a flow configuration outline:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;FlowConfiguration&gt;</span>
  <span class="nt">&lt;id&gt;&lt;/id&gt;</span>
  <span class="nt">&lt;name&gt;&lt;/name&gt;</span>
  <span class="nt">&lt;description&gt;&lt;/description&gt;</span>

  <span class="nt">&lt;corePoolSize&gt;</span>10<span class="nt">&lt;/corePoolSize&gt;</span>
  <span class="nt">&lt;maximumPoolSize&gt;</span>30<span class="nt">&lt;/maximumPoolSize&gt;</span>
  <span class="nt">&lt;keepAliveTime&gt;</span>150<span class="nt">&lt;/keepAliveTime&gt;</span> <span class="c">&lt;!--seconds--&gt;</span>
  <span class="nt">&lt;workQueueSize&gt;</span>100<span class="nt">&lt;/workQueueSize&gt;</span>

      <span class="c">&lt;!-- optional: used to override the default --&gt;</span>
      <span class="nt">&lt;overrideConfigDir&gt;&lt;/overrideConfigDir&gt;</span>

      <span class="c">&lt;!-- keep consumer instance into memory map until they are manually removed --&gt;</span>
  <span class="nt">&lt;keepConsumers&gt;</span>false<span class="nt">&lt;/keepConsumers&gt;</span>
  <span class="c">&lt;!-- maximum number of consumer instances --&gt;</span>
  <span class="nt">&lt;maxStoredConsumers&gt;</span>6<span class="nt">&lt;/maxStoredConsumers&gt;</span>

  <span class="nt">&lt;EventGeneratorConfiguration&gt;</span>
    <span class="nt">&lt;serviceID&gt;&lt;/serviceID&gt;</span>
  <span class="nt">&lt;/EventGeneratorConfiguration&gt;</span>

  <span class="nt">&lt;EventConsumerConfiguration&gt;</span>
    <span class="c">&lt;!-- keep runtime dir when consumer instance is disposed --&gt;</span>
    <span class="nt">&lt;keepRuntimeDir&gt;</span>[true|false]<span class="nt">&lt;keepRuntimeDir&gt;</span>

    <span class="nt">&lt;ACTION_1_Configuration&gt;</span>
                      <span class="c">&lt;!-- optional: used to override the default --&gt;</span>
                      <span class="nt">&lt;overrideConfigDir&gt;&lt;/overrideConfigDir&gt;</span>
    <span class="nt">&lt;/ACTION_1_Configuration&gt;</span>
    <span class="nt">&lt;ACTION_N_Configuration&gt;</span>
    <span class="nt">&lt;/ACTION_N_Configuration&gt;</span>
  <span class="nt">&lt;/EventConsumerConfiguration&gt;</span>

  <span class="nt">&lt;ListenerConfigurations&gt;</span>
  <span class="nt">&lt;/ListenerConfigurations&gt;</span>
<span class="nt">&lt;/FlowConfiguration&gt;</span>
</pre></div>
</div>
<div class="section" id="identifiers">
<h2>Identifiers<a class="headerlink" href="#identifiers" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">&lt;FlowConfiguration&gt;</span></code> represents an <em>identifiable</em> resource, so you have to specify an <code class="docutils literal"><span class="pre">id</span></code>, a <code class="docutils literal"><span class="pre">name</span></code> and a <code class="docutils literal"><span class="pre">description</span></code>:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;id&gt;</span>FLOW_ID<span class="nt">&lt;/id&gt;</span>
<span class="nt">&lt;name&gt;</span>FLOW_NAME<span class="nt">&lt;/name&gt;</span>
<span class="nt">&lt;description&gt;</span>FLOW_DESCRIPTION<span class="nt">&lt;/description&gt;</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">id</span></code> has to be the same as the flow configuration file name. For example, a file called <code class="docutils literal"><span class="pre">example_flow.xml</span></code> will contain:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;id&gt;</span>example_flow<span class="nt">&lt;/id&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="config-directory">
<h2>Config directory<a class="headerlink" href="#config-directory" title="Permalink to this headline">¶</a></h2>
<p>Can be relative to the <code class="docutils literal"><span class="pre">GEOBATCH_CONFIG_DIR</span></code>, or an absolute path and accepted into consumer and action configuration nodes:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- optional: used to override the default --&gt;</span>
    <span class="nt">&lt;overrideConfigDir&gt;</span>override_dir<span class="nt">&lt;/overrideConfigDir&gt;</span>
</pre></div>
</div>
<p>If not specified, it will be assumed to be <code class="docutils literal"><span class="pre">GEOBATCH_CONFIG_DIR/FLOW_ID</span></code> for consumer and <code class="docutils literal"><span class="pre">GEOBATCH_CONFIG_DIR/FLOW_ID/ACTION_ID</span></code> for actions.</p>
</div>
<div class="section" id="thread-pool">
<h2>Thread pool<a class="headerlink" href="#thread-pool" title="Permalink to this headline">¶</a></h2>
<p>Each Flow configuration is handled by a Flow Manager instance which creates a new <code class="docutils literal"><span class="pre">ThreadPoolExecutor</span></code> with the given initial parameters and default thread factory and handler. It may be more convenient to use one of the Executor&#8217;s factory methods instead of this general purpose constructor.</p>
<p>Elements:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&lt;corePoolSize&gt;</span></code>: The number of threads to keep in the pool, even if they are idle.</li>
<li><code class="docutils literal"><span class="pre">&lt;maximumPoolSize&gt;</span></code>: The maximum number of threads to allow in the pool.</li>
<li><code class="docutils literal"><span class="pre">&lt;keepAliveTime&gt;</span></code>: When the number of threads is greater than the core pool size, this is the maximum time (in seconds) that the exceeding threads will live in idle state.</li>
<li><code class="docutils literal"><span class="pre">&lt;workQueueSize&gt;</span></code>: the size of the queue to use for holding tasks before they are executed. This queue will hold only the Runnable tasks submitted by the execute method.</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;FlowConfiguration&gt;
  &lt;id&gt;FLOW_NAME&lt;/id&gt;
  &lt;name&gt;NAME&lt;/name&gt;
  &lt;description&gt;DESCRIPTION&lt;/description&gt;
  &lt;autorun&gt;true&lt;/autorun&gt;

  &lt;corePoolSize&gt;10&lt;/corePoolSize&gt;
  &lt;maximumPoolSize&gt;30&lt;/maximumPoolSize&gt;
  &lt;keepAliveTime&gt;150&lt;/keepAliveTime&gt; &lt;!--seconds--&gt;
  &lt;workQueueSize&gt;100&lt;/workQueueSize&gt;

      &lt;-- maximum numbers of stored consumers executions (as shown into the GUI) --&gt;
  &lt;!-- DEFAULT_maxStoredConsumers = 100 --&gt;
  &lt;maxStoredConsumers&gt;100&lt;/maxStoredConsumers&gt;

      &lt;-- keep consumer into the store until a dispose is called (via GUI or JMX) --&gt;
      &lt;!-- default is set to false which means that when maxStoredConsumer is reached if a new consumer is requested (f.e.: generating a new event) the oldest one will be removed --&gt;
  &lt;keepConsumers&gt;false&lt;/keepConsumers&gt;

      &lt;-- keep temporary directory into the store when a dispose is called (automatically by the flow manager or via GUI or JMX) --&gt;
      &lt;!-- default is set to false which means that when maxStoredConsumer is reached if a new consumer is requested (f.e.: generating a new event) the oldest one will be removed --&gt;
      &lt;keepTempDir&gt;false&lt;/keepTempDir&gt;

&lt;/FlowConfiguration&gt;
</pre></div>
</div>
</div>
<div class="section" id="consumer-configuration">
<h2>Consumer configuration<a class="headerlink" href="#consumer-configuration" title="Permalink to this headline">¶</a></h2>
<p>This is an <em>identifiable</em> component so you have to specify <code class="docutils literal"><span class="pre">id</span></code>, <code class="docutils literal"><span class="pre">name</span></code> and <code class="docutils literal"><span class="pre">description</span></code>. Plus:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&lt;listenerId&gt;</span></code>: List of listeners used by this consumer, specified by ID (see <a class="reference internal" href="#listener-configuration">listener configuration</a> for details).</li>
<li><code class="docutils literal"><span class="pre">&lt;preserveInput&gt;</span></code>: <code class="docutils literal"><span class="pre">true</span></code> to preserve input files. Defaults to <code class="docutils literal"><span class="pre">false</span></code>. If this flag is set to <code class="docutils literal"><span class="pre">true</span></code> the consumer will work directly on the input data. Please be careful with this option since the event generator can trigger events on file modification.</li>
<li><code class="docutils literal"><span class="pre">&lt;performBackup&gt;</span></code>: <code class="docutils literal"><span class="pre">true</span></code> to create a directory called <code class="docutils literal"><span class="pre">backup</span></code> under the working directory. Defaults to <code class="docutils literal"><span class="pre">false</span></code>.</li>
<li><strong>Actions</strong>: A list of actions. Element names depend on the type of action to be performed.</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;EventConsumerConfiguration&gt;</span>

  <span class="nt">&lt;listenerId&gt;</span>ConsumerLogger0<span class="nt">&lt;/listenerId&gt;</span>
  <span class="nt">&lt;listenerId&gt;</span>ConsumerCumulator0<span class="nt">&lt;/listenerId&gt;</span>

  <span class="nt">&lt;preserveInput&gt;</span>false<span class="nt">&lt;/preserveInput&gt;</span>
  <span class="nt">&lt;performBackup&gt;</span>false<span class="nt">&lt;/performBackup&gt;</span>

  <span class="nt">&lt;ACTION_1_Configuration&gt;</span>
  <span class="nt">&lt;/ACTION_1_Configuration&gt;</span>

  <span class="nt">&lt;ACTION_N_Configuration&gt;</span>
  <span class="nt">&lt;/ACTION_N_Configuration&gt;</span>

<span class="nt">&lt;/EventConsumerConfiguration&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="event-generator">
<h2>Event generator<a class="headerlink" href="#event-generator" title="Permalink to this headline">¶</a></h2>
<p>Actually, the only supported event generator is the <em>File System Event Generator</em>.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;EventGeneratorConfiguration&gt;</span>
  <span class="nt">&lt;serviceID&gt;</span>fsEventGeneratorService<span class="nt">&lt;/serviceID&gt;</span>

<span class="nt">&lt;/EventGeneratorConfiguration&gt;</span>
</pre></div>
</div>
<div class="section" id="filesystem-event-generator">
<h3>Filesystem Event Generator<a class="headerlink" href="#filesystem-event-generator" title="Permalink to this headline">¶</a></h3>
<p>Again, it is an <em>identifiable</em> object, with an id, a name and a description. Other elements:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&lt;interval&gt;</span></code>: Polling interval (in milliseconds). Positive long integer (ranging 1 to 2e63-1). Defaults to 5000.</li>
</ul>
<p>Example:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;EventGeneratorConfiguration&gt;</span>
  <span class="nt">&lt;serviceID&gt;</span>fsEventGeneratorService<span class="nt">&lt;/serviceID&gt;</span>
  <span class="nt">&lt;wildCard&gt;</span>*.*<span class="nt">&lt;/wildCard&gt;</span>
  <span class="nt">&lt;watchDirectory&gt;</span>geotiff/in<span class="nt">&lt;/watchDirectory&gt;</span>
  <span class="nt">&lt;osType&gt;</span>OS_UNDEFINED<span class="nt">&lt;/osType&gt;</span>
  <span class="nt">&lt;eventType&gt;</span>FILE_ADDED<span class="nt">&lt;/eventType&gt;</span>
  <span class="nt">&lt;interval&gt;</span>10000<span class="nt">&lt;/interval&gt;</span>
<span class="nt">&lt;/EventGeneratorConfiguration&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="listener-configuration">
<h2>Listener configuration<a class="headerlink" href="#listener-configuration" title="Permalink to this headline">¶</a></h2>
<p>Each listener configuration is referred from other places using the <code class="docutils literal"><span class="pre">&lt;listenerId&gt;</span></code> element, whose value corresponds to the listener&#8217;s <code class="docutils literal"><span class="pre">&lt;id&gt;</span></code> value.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&lt;id&gt;</span></code>: Listener&#8217;s identifier.</li>
<li><code class="docutils literal"><span class="pre">&lt;serviceID&gt;</span></code>: Represents an alias id for the class to use and (actually) can be:<ul>
<li><em>cumulatingListenerService</em>: It is a service that is used to instantiate ProgressCumulatingListener (class), which is used by graphical interface to send status messages to the graphical interface, and must be configured at the level of consumer.</li>
<li><em>statusListenerService</em>: It is a service that is used to instantiate ProgressStatusListener (class). Used to define lists that graphical interface uses to monitor the status of individual actions. Should be used only in the configuration of an action.</li>
<li><em>loggingListenerService</em>: It is a service that is used to instantiate ProgressLoggingListener (class), is used to log events in progress. For example:<ol class="arabic">
<li><em>Consumer started</em></li>
<li><em>Action started</em></li>
<li><em>Action concluded</em></li>
</ol>
</li>
</ul>
</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;ListenerConfigurations&gt;</span>
  <span class="nt">&lt;CumulatingProgressListener&gt;</span>
    <span class="nt">&lt;serviceID&gt;</span>cumulatingListenerService<span class="nt">&lt;/serviceID&gt;</span>
    <span class="nt">&lt;id&gt;</span>ConsumerLogger0<span class="nt">&lt;/id&gt;</span>
  <span class="nt">&lt;/CumulatingProgressListener&gt;</span>

  <span class="nt">&lt;StatusProgressListener&gt;</span>
    <span class="nt">&lt;serviceID&gt;</span>statusListenerService<span class="nt">&lt;/serviceID&gt;</span>
    <span class="nt">&lt;id&gt;</span>ActionListener0<span class="nt">&lt;/id&gt;</span>
  <span class="nt">&lt;/StatusProgressListener&gt;</span>

  <span class="nt">&lt;LoggingProgressListener&gt;</span>
    <span class="nt">&lt;serviceID&gt;</span>loggingListenerService<span class="nt">&lt;/serviceID&gt;</span>
    <span class="nt">&lt;id&gt;</span>ActionListener1<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;loggerName&gt;</span>ActionListener1<span class="nt">&lt;/loggerName&gt;</span>
  <span class="nt">&lt;/LoggingProgressListener&gt;</span>

  <span class="nt">&lt;LoggingProgressListener&gt;</span>
    <span class="nt">&lt;serviceID&gt;</span>loggingListenerService<span class="nt">&lt;/serviceID&gt;</span>
    <span class="nt">&lt;id&gt;</span>ConsumerLogger0<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;loggerName&gt;</span>ConsumerLogger0<span class="nt">&lt;/loggerName&gt;</span>
  <span class="nt">&lt;/LoggingProgressListener&gt;</span>
<span class="nt">&lt;/ListenerConfigurations&gt;</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Flow configuration</a><ul>
<li><a class="reference internal" href="#identifiers">Identifiers</a></li>
<li><a class="reference internal" href="#config-directory">Config directory</a></li>
<li><a class="reference internal" href="#thread-pool">Thread pool</a></li>
<li><a class="reference internal" href="#consumer-configuration">Consumer configuration</a></li>
<li><a class="reference internal" href="#event-generator">Event generator</a><ul>
<li><a class="reference internal" href="#filesystem-event-generator">Filesystem Event Generator</a></li>
</ul>
</li>
<li><a class="reference internal" href="#listener-configuration">Listener configuration</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">UNREDD NFMS 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2012, FAO Forestry &amp; GeoSolutions SAS.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>